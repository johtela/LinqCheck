

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Container - LinqCheck</title>

	<link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <link rel="stylesheet" href="../bootstrap/css/simplex/bootstrap.min.css" />
<link rel="stylesheet" href="../font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="../sidebar/sidebar.min.css" />
<link rel="stylesheet" href="../css/modern.min.css" />
<link rel="stylesheet" href="../syntax-highlight/son-of-obsidian.min.css" />
<link rel="stylesheet" href="../mermaid/mermaid.css" />

</head>

<body>
    
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../index.html"><span><img src="../images/LinqCheck2.svg" height="24" />  LinqCheck</span></a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="../index.html"><i class="fa fa-home" aria-hidden="true"></i> Home</a></li>
					<li><a href="https://github.com/johtela/LinqCheck"><i class="fa fa-github" aria-hidden="true"></i> GitHub Repository</a></li>
                    <li><a href="../License.html">License</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col-md-3 hidden-xs hidden-sm">
                
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>On This Page</h4>
            </div>
            <div id="header-menu" class="panel-body main-menu">
                <ul></ul>
            </div>
        </div>  
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>Table of Contents</h4>
            </div>
            <div class="panel-body main-menu">
                <ul>
	<li><a href="../index.html">Home</a></li>
	<ul>
	</ul>
	<li>Usage</li>
	<ul>
<ul>
	<li><a href="../Examples/BasicTests.html">Writing Simple Tests</a></li>
	<ul>
	</ul>
	<li><a href="../Examples/SeqTests.html">Adding New Arbitrary Types</a></li>
	<ul>
	</ul>
	<li><a href="../Examples/UITests/Calculator.html">Testing Programs with Mutable State</a></li>
	<ul>
	</ul>
	<li><a href="../Examples/UITests/ModelCalculator.html">Implementing a Model</a></li>
	<ul>
	</ul>
	<li><a href="../Examples/UITests/Automated.html">Using UI Automation</a></li>
	<ul>
	</ul>
	<li><a href="../Examples/UITests/Win7Calculator.html">Windows 7 Calculator</a></li>
	<ul>
	</ul>
	<li><a href="../Examples/UITests/Win10Calculator.html">Windows 10 Calculator</a></li>
	<ul>
	</ul>
	<li><a href="../Examples/UITests/CalculatorTests.html">Testing the Calculator</a></li>
	<ul>
	</ul>
	<li><a href="../Examples/RunTests.html">Running the Tests</a></li>
	<ul>
	</ul>
</ul>
	</ul>
	<li>Implementation</li>
	<ul>
<ul>
	<li><a href="../src/Gen.html">Generators and Monads</a></li>
	<ul>
	</ul>
	<li><a href="../src/Arbitrary.html">Generating and Shrinking Arbitrary Values</a></li>
	<ul>
	</ul>
	<li><a href="../src/DefaultArbitrary.html">Built-In Arbitrary Types</a></li>
	<ul>
	</ul>
	<li><a href="../src/Container.html" class="selected">Container for Arbitrary Implementations</a></li>
	<ul>
	</ul>
	<li><a href="../src/TestState.html">Test State and Phases</a></li>
	<ul>
	</ul>
	<li><a href="../src/Prop.html">Properties</a></li>
	<ul>
	</ul>
	<li><a href="../src/Tester.html">Test Runner</a></li>
	<ul>
	</ul>
</ul>
	</ul>
	<li><a href="../License.html">License</a></li>
	<ul>
	</ul>
</ul>
            </div>
        </div>

            </div>
			<div class="col-md-9">
				<ul class="pager">
	<li class="previous"><a href="../src/DefaultArbitrary.html">Previous: Built-In Arbitrary Types</a></li>
	<li class="next"><a href="../src/TestState.html">Next: Test State and Phases</a></li>
</ul>
				<div id="static-content" class="markdown">
					<h1 id="container-for-arbitrary-implementations">Container for Arbitrary Implementations</h1>
<p>We need a helper class to register and retrieve interface implementations at
runtime. Classes that use runtime type information to manage interface
implementations are typically called <em>containers</em> in
<a href="https://en.wikipedia.org/wiki/Inversion_of_control">IoC</a> frameworks. We
define a simple container class that helps us dynamically create objects which
implement the IArbitrary interface. The class we write supports any generic
interface, but we use it exclusively with <code>IArbitrary&lt;T&gt;</code>.</p>
<pre class="csharp"><code class="csharp"><span class="keyword" id="LinqCheck">namespace</span> LinqCheck
<span class="punctuation">{</span>
	<span class="keyword">using</span> System<span class="punctuation">;</span>
	<span class="keyword">using</span> System<span class="punctuation">.</span>Collections<span class="punctuation">.</span>Generic<span class="punctuation">;</span>
	<span class="keyword">using</span> System<span class="punctuation">.</span>Linq<span class="punctuation">;</span>
	<span class="keyword">using</span> System<span class="punctuation">.</span>Reflection<span class="punctuation">;</span>

	<span class="keyword" id="LinqCheck.Container">public</span> <span class="keyword">class</span> <span class="typename">Container</span>
	<span class="punctuation">{</span>
</code></pre>
<h2 id="stored-data">Stored Data</h2>
<p>The runtime type handle is of the generic interface is stored in the
following field.</p>
<pre class="csharp"><code class="csharp">		<span class="keyword">private</span> <span class="typename" data-toggle="tooltip" title="System.Type">Type</span> <span id="LinqCheck.Container._interface">_interface</span><span class="punctuation">;</span>
</code></pre>
<p>The types implementing the interface are stored in a dictionary. The
keys of the dictionary are the interface's generic type parameters, and
the	values are the types which implement the specific interface
instance.</p>
<pre class="csharp"><code class="csharp">		<span class="keyword">private</span> <span class="typename" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>">Dictionary</span><span class="punctuation">&lt;</span><span class="typename" data-toggle="tooltip" title="System.Type">Type</span><span class="punctuation">,</span> <span class="typename" data-toggle="tooltip" title="System.Type">Type</span><span class="punctuation">&gt;</span> <span id="LinqCheck.Container._types">_types</span><span class="punctuation">;</span>
</code></pre>
<p>An alternative method to register an implementation is to use a
singleton object instead of a type. The dictionary below stores
those. As above, its keys are the interface's generic type parameters,
but its values objects which implement the interface instance.</p>
<pre class="csharp"><code class="csharp">		<span class="keyword">private</span> <span class="typename" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>">Dictionary</span><span class="punctuation">&lt;</span><span class="typename" data-toggle="tooltip" title="System.Type">Type</span><span class="punctuation">,</span> <span class="keyword" data-toggle="tooltip" title="object">object</span><span class="punctuation">&gt;</span> <span id="LinqCheck.Container._objects">_objects</span><span class="punctuation">;</span>
</code></pre>
<h2 id="constructor">Constructor</h2>
<p>The constructor takes the runtime type handle of the generic interface
and stores in the <code>_interface</code> field. It checks that the type object
corresponds to an interface, and that interface is generic. The
constructor also creates the two dictionaries introduced above.</p>
<pre class="csharp"><code class="csharp">		<span class="keyword" id="LinqCheck.Container.Container(System.Type)" data-toggle="tooltip" title="LinqCheck.Container.Container(System.Type)">public</span> <span data-toggle="tooltip" title="LinqCheck.Container.Container(System.Type)">Container</span> <span class="punctuation">(</span><span class="typename" data-toggle="tooltip" title="System.Type">Type</span> intf<span class="punctuation">)</span>
		<span class="punctuation">{</span>
			<span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation" data-toggle="tooltip" title="bool">!</span><span class="punctuation" data-toggle="tooltip" title="bool">(</span><span data-toggle="tooltip" title="System.Type">intf</span><span class="punctuation" data-toggle="tooltip" title="bool">.</span><span data-toggle="tooltip" title="bool">IsInterface</span> <span class="punctuation" data-toggle="tooltip" title="bool">&amp;&amp;</span> <span data-toggle="tooltip" title="System.Type">intf</span><span class="punctuation" data-toggle="tooltip" title="bool">.</span><span data-toggle="tooltip" title="bool">IsGenericType</span><span class="punctuation" data-toggle="tooltip" title="bool">)</span><span class="punctuation">)</span>
				<span class="keyword">throw</span> <span class="keyword" data-toggle="tooltip" title="System.ArgumentException">new</span> <span class="typename">ArgumentException</span> <span class="punctuation">(</span>
					<span class="string" data-toggle="tooltip" title="string">&quot;Given type must be generic interface.&quot;</span><span class="punctuation">,</span> <span class="string" data-toggle="tooltip" title="string">&quot;intf&quot;</span><span class="punctuation">)</span><span class="punctuation">;</span>
			<span data-toggle="tooltip" title="System.Type"><a href="../src/Container.html#LinqCheck.Container._interface">_interface</a></span> <span class="punctuation" data-toggle="tooltip" title="System.Type">=</span> <span data-toggle="tooltip" title="System.Type">intf</span><span class="punctuation">;</span>
			<span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>"><a href="../src/Container.html#LinqCheck.Container._types">_types</a></span> <span class="punctuation" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>">=</span> <span class="keyword" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>">new</span> <span class="typename">Dictionary</span><span class="punctuation">&lt;</span><span class="typename" data-toggle="tooltip" title="System.Type">Type</span><span class="punctuation">,</span> <span class="typename" data-toggle="tooltip" title="System.Type">Type</span><span class="punctuation">&gt;</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
			<span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>"><a href="../src/Container.html#LinqCheck.Container._objects">_objects</a></span> <span class="punctuation" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>">=</span> <span class="keyword" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>">new</span> <span class="typename">Dictionary</span><span class="punctuation">&lt;</span><span class="typename" data-toggle="tooltip" title="System.Type">Type</span><span class="punctuation">,</span> <span class="keyword" data-toggle="tooltip" title="object">object</span><span class="punctuation">&gt;</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
		<span class="punctuation">}</span>
</code></pre>
<h2 id="registering-implementations">Registering Implementations</h2>
<p>We provide several ways of registering implementations. The most
sweeping version takes an assembly and registers all types defined in
it.</p>
<pre class="csharp"><code class="csharp">		<span class="keyword" id="LinqCheck.Container.Register(System.Reflection.Assembly)" data-toggle="tooltip" title="LinqCheck.Container.Register(System.Reflection.Assembly)">public</span> <span class="keyword" data-toggle="tooltip" title="void">void</span> <span data-toggle="tooltip" title="LinqCheck.Container.Register(System.Reflection.Assembly)">Register</span> <span class="punctuation">(</span><span class="typename" data-toggle="tooltip" title="System.Reflection.Assembly">Assembly</span> assembly<span class="punctuation">)</span>
		<span class="punctuation">{</span>
			<span class="keyword">foreach</span> <span class="punctuation">(</span><span class="keyword" data-toggle="tooltip" title="System.Type">var</span> type <span class="keyword">in</span> <span data-toggle="tooltip" title="System.Reflection.Assembly">assembly</span><span class="punctuation" data-toggle="tooltip" title="System.Reflection.Assembly.GetTypes()">.</span><span data-toggle="tooltip" title="System.Reflection.Assembly.GetTypes()">GetTypes</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span>
				<span data-toggle="tooltip" title="LinqCheck.Container.Register(System.Type)"><a href="../src/Container.html#LinqCheck.Container.Register(System.Type)">Register</a></span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation">)</span><span class="punctuation">;</span>
		<span class="punctuation">}</span>
</code></pre>
<p>The following overload is used to register a type that implements one
or more interface instances. It throws an exception if the type is
already registered, or if the implementation does have a default
constructor.</p>
<pre class="csharp"><code class="csharp">		<span class="keyword" id="LinqCheck.Container.Register(System.Type)" data-toggle="tooltip" title="LinqCheck.Container.Register(System.Type)">public</span> <span class="keyword" data-toggle="tooltip" title="void">void</span> <span data-toggle="tooltip" title="LinqCheck.Container.Register(System.Type)">Register</span> <span class="punctuation">(</span><span class="typename" data-toggle="tooltip" title="System.Type">Type</span> type<span class="punctuation">)</span>
		<span class="punctuation">{</span>
			<span class="keyword">if</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>"><a href="../src/Container.html#LinqCheck.Container._types">_types</a></span><span class="punctuation" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>.ContainsKey(System.Type)">.</span><span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>.ContainsKey(System.Type)">ContainsKey</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation">)</span><span class="punctuation">)</span>
				<span class="keyword">throw</span> <span class="keyword" data-toggle="tooltip" title="System.ArgumentException">new</span> <span class="typename">ArgumentException</span> <span class="punctuation">(</span><span class="keyword" data-toggle="tooltip" title="string">string</span><span class="punctuation" data-toggle="tooltip" title="string.Format(string, object)">.</span><span data-toggle="tooltip" title="string.Format(string, object)">Format</span> <span class="punctuation">(</span>
					<span class="string" data-toggle="tooltip" title="string">&quot;Type {0} is already registered&quot;</span><span class="punctuation">,</span> <span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
			<span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation" data-toggle="tooltip" title="bool">!</span><span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation" data-toggle="tooltip" title="System.Type.GetConstructors()">.</span><span data-toggle="tooltip" title="System.Type.GetConstructors()">GetConstructors</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation" data-toggle="tooltip" title="System.Collections.Generic.IEnumerable<System.Reflection.ConstructorInfo>.Any<System.Reflection.ConstructorInfo>(System.Func<System.Reflection.ConstructorInfo, bool>)">.</span><span data-toggle="tooltip" title="System.Collections.Generic.IEnumerable<System.Reflection.ConstructorInfo>.Any<System.Reflection.ConstructorInfo>(System.Func<System.Reflection.ConstructorInfo, bool>)">Any</span> <span class="punctuation">(</span>x <span class="punctuation" data-toggle="tooltip" title="lambda expression">=&gt;</span> <span data-toggle="tooltip" title="System.Reflection.ConstructorInfo">x</span><span class="punctuation" data-toggle="tooltip" title="System.Reflection.MethodBase.GetParameters()">.</span><span data-toggle="tooltip" title="System.Reflection.MethodBase.GetParameters()">GetParameters</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation" data-toggle="tooltip" title="int">.</span><span data-toggle="tooltip" title="int">Length</span> <span class="punctuation" data-toggle="tooltip" title="bool">==</span> <span class="number" data-toggle="tooltip" title="int">0</span><span class="punctuation">)</span><span class="punctuation">)</span>
				<span class="keyword">throw</span> <span class="keyword" data-toggle="tooltip" title="System.ArgumentException">new</span> <span class="typename">ArgumentException</span> <span class="punctuation">(</span><span class="keyword" data-toggle="tooltip" title="string">string</span><span class="punctuation" data-toggle="tooltip" title="string.Format(string, object)">.</span><span data-toggle="tooltip" title="string.Format(string, object)">Format</span> <span class="punctuation">(</span>
					<span class="string" data-toggle="tooltip" title="string">&quot;Type {0} does not contain a default constructor&quot;</span><span class="punctuation">,</span> <span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
			<span class="keyword">foreach</span> <span class="punctuation">(</span><span class="keyword" data-toggle="tooltip" title="System.Type">var</span> argType <span class="keyword">in</span> <span data-toggle="tooltip" title="LinqCheck.Container.ArgumentTypes(System.Type)"><a href="../src/Container.html#LinqCheck.Container.ArgumentTypes(System.Type)">ArgumentTypes</a></span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation">)</span><span class="punctuation">)</span>
				<span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>"><a href="../src/Container.html#LinqCheck.Container._types">_types</a></span><span class="punctuation" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>.Add(System.Type, System.Type)">.</span><span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>.Add(System.Type, System.Type)">Add</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="LinqCheck.Container.GenericDef(System.Type)"><a href="../src/Container.html#LinqCheck.Container.GenericDef(System.Type)">GenericDef</a></span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">argType</span><span class="punctuation">)</span><span class="punctuation">,</span> <span data-toggle="tooltip" title="LinqCheck.Container.GenericDef(System.Type)"><a href="../src/Container.html#LinqCheck.Container.GenericDef(System.Type)">GenericDef</a></span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
		<span class="punctuation">}</span>
</code></pre>
<p>The last overload takes an object, finds out which interface instances
it implements, and adds all of them to the <code>_objects</code> dictionary.</p>
<pre class="csharp"><code class="csharp">		<span class="keyword" id="LinqCheck.Container.Register(object)" data-toggle="tooltip" title="LinqCheck.Container.Register(object)">public</span> <span class="keyword" data-toggle="tooltip" title="void">void</span> <span data-toggle="tooltip" title="LinqCheck.Container.Register(object)">Register</span> <span class="punctuation">(</span><span class="keyword" data-toggle="tooltip" title="object">object</span> obj<span class="punctuation">)</span>
		<span class="punctuation">{</span>
			<span class="keyword" data-toggle="tooltip" title="System.Type">var</span> <span id="type">type</span> <span class="punctuation">=</span> <span data-toggle="tooltip" title="object">obj</span><span class="punctuation" data-toggle="tooltip" title="object.GetType()">.</span><span data-toggle="tooltip" title="object.GetType()">GetType</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
			<span class="keyword">if</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>"><a href="../src/Container.html#LinqCheck.Container._objects">_objects</a></span><span class="punctuation" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>.ContainsKey(System.Type)">.</span><span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>.ContainsKey(System.Type)">ContainsKey</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation">)</span><span class="punctuation">)</span>
				<span class="keyword">throw</span> <span class="keyword" data-toggle="tooltip" title="System.ArgumentException">new</span> <span class="typename">ArgumentException</span> <span class="punctuation">(</span><span class="keyword" data-toggle="tooltip" title="string">string</span><span class="punctuation" data-toggle="tooltip" title="string.Format(string, object)">.</span><span data-toggle="tooltip" title="string.Format(string, object)">Format</span> <span class="punctuation">(</span>
					<span class="string" data-toggle="tooltip" title="string">&quot;Type {0} is already registered&quot;</span><span class="punctuation">,</span> <span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>

			<span class="keyword">foreach</span> <span class="punctuation">(</span><span class="keyword" data-toggle="tooltip" title="System.Type">var</span> argType <span class="keyword">in</span> <span data-toggle="tooltip" title="LinqCheck.Container.ArgumentTypes(System.Type)"><a href="../src/Container.html#LinqCheck.Container.ArgumentTypes(System.Type)">ArgumentTypes</a></span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation">)</span><span class="punctuation">)</span>
				<span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>"><a href="../src/Container.html#LinqCheck.Container._objects">_objects</a></span><span class="punctuation" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>.Add(System.Type, object)">.</span><span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>.Add(System.Type, object)">Add</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">argType</span><span class="punctuation">,</span> <span data-toggle="tooltip" title="object">obj</span><span class="punctuation">)</span><span class="punctuation">;</span>
		<span class="punctuation">}</span>
</code></pre>
<h2 id="retrieving-an-implementation">Retrieving an Implementation</h2>
<p>Depending on how the implementation is registered the method below
will either locate or construct it as needed. If an implementation
is not registered the <code>ImplementingType</code> helper method will throw an
exception.</p>
<pre class="csharp"><code class="csharp">		<span class="keyword" id="LinqCheck.Container.GetImplementation(System.Type)" data-toggle="tooltip" title="LinqCheck.Container.GetImplementation(System.Type)">public</span> <span class="keyword" data-toggle="tooltip" title="object">object</span> <span data-toggle="tooltip" title="LinqCheck.Container.GetImplementation(System.Type)">GetImplementation</span> <span class="punctuation">(</span><span class="typename" data-toggle="tooltip" title="System.Type">Type</span> argType<span class="punctuation">)</span>
		<span class="punctuation">{</span>
			<span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation" data-toggle="tooltip" title="bool">!</span><span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>"><a href="../src/Container.html#LinqCheck.Container._objects">_objects</a></span><span class="punctuation" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>.TryGetValue(System.Type, out object)">.</span><span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>.TryGetValue(System.Type, out object)">TryGetValue</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">argType</span><span class="punctuation">,</span> <span class="keyword">out</span> <span class="keyword" data-toggle="tooltip" title="object">object</span> result<span class="punctuation">)</span><span class="punctuation">)</span>
			<span class="punctuation">{</span>
				<span class="typename" data-toggle="tooltip" title="System.Type">Type</span> <span id="implementingType">implementingType</span> <span class="punctuation">=</span> <span data-toggle="tooltip" title="LinqCheck.Container.ImplementingType(System.Type)"><a href="../src/Container.html#LinqCheck.Container.ImplementingType(System.Type)">ImplementingType</a></span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">argType</span><span class="punctuation">)</span><span class="punctuation">;</span>
				<span data-toggle="tooltip" title="object">result</span> <span class="punctuation" data-toggle="tooltip" title="object">=</span> <span class="typename" data-toggle="tooltip" title="System.Activator">Activator</span><span class="punctuation" data-toggle="tooltip" title="System.Activator.CreateInstance(System.Type)">.</span><span data-toggle="tooltip" title="System.Activator.CreateInstance(System.Type)">CreateInstance</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">implementingType</span><span class="punctuation">)</span><span class="punctuation">;</span>
				<span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>"><a href="../src/Container.html#LinqCheck.Container._objects">_objects</a></span><span class="punctuation" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>.Add(System.Type, object)">.</span><span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, object>.Add(System.Type, object)">Add</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">argType</span><span class="punctuation">,</span> <span data-toggle="tooltip" title="object">result</span><span class="punctuation">)</span><span class="punctuation">;</span>
			<span class="punctuation">}</span>
			<span class="keyword">return</span> <span data-toggle="tooltip" title="object">result</span><span class="punctuation">;</span>
		<span class="punctuation">}</span>
</code></pre>
<h2 id="helper-methods">Helper Methods</h2>
<p>Rest of the methods of the Container class are private helpers, which
simplify the work of the methods defined above. The <code>GenericDef</code> method
takes a type handle and returns its generic definition. For arrays this
is the <a href="https://msdn.microsoft.com/en-us/library/system.array(v=vs.110).aspx">System.Array</a>
class. For instances of generic types the methods returns the type
handle where none of the generic parameters is instantiated. If the
type given is not generic at all, it is returned back as-is.</p>
<pre class="csharp"><code class="csharp">		<span class="keyword" id="LinqCheck.Container.GenericDef(System.Type)" data-toggle="tooltip" title="LinqCheck.Container.GenericDef(System.Type)">private</span> <span class="keyword" data-toggle="tooltip" title="LinqCheck.Container.GenericDef(System.Type)">static</span> <span class="typename" data-toggle="tooltip" title="System.Type">Type</span> <span data-toggle="tooltip" title="LinqCheck.Container.GenericDef(System.Type)">GenericDef</span> <span class="punctuation">(</span><span class="typename" data-toggle="tooltip" title="System.Type">Type</span> type<span class="punctuation">)</span>
		<span class="punctuation">{</span>
			<span class="keyword">return</span> <span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation" data-toggle="tooltip" title="bool">.</span><span data-toggle="tooltip" title="bool">IsArray</span> <span class="punctuation" data-toggle="tooltip" title="System.Type">?</span> 
				<span class="keyword" data-toggle="tooltip" title="System.Type">typeof</span> <span class="punctuation" data-toggle="tooltip" title="System.Type">(</span><span class="typename" data-toggle="tooltip" title="System.Array">Array</span><span class="punctuation" data-toggle="tooltip" title="System.Type">)</span> <span class="punctuation" data-toggle="tooltip" title="System.Type">:</span>
				<span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation" data-toggle="tooltip" title="bool">.</span><span data-toggle="tooltip" title="bool">IsGenericType</span> <span class="punctuation" data-toggle="tooltip" title="System.Type">?</span> 
					<span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation" data-toggle="tooltip" title="System.Type.GetGenericTypeDefinition()">.</span><span data-toggle="tooltip" title="System.Type.GetGenericTypeDefinition()">GetGenericTypeDefinition</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation" data-toggle="tooltip" title="System.Type">:</span> 
					<span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation">;</span>
		<span class="punctuation">}</span>
</code></pre>
<p>Given a type handle, we need to find out which instances of the generic
interface it implements. The <code>ArgumentTypes</code> method does this and
returns an IEnumerable of type parameter instantiations.</p>
<pre class="csharp"><code class="csharp">		<span class="keyword" id="LinqCheck.Container.ArgumentTypes(System.Type)" data-toggle="tooltip" title="LinqCheck.Container.ArgumentTypes(System.Type)">private</span> <span class="typename" data-toggle="tooltip" title="System.Collections.Generic.IEnumerable<System.Type>">IEnumerable</span><span class="punctuation">&lt;</span><span class="typename" data-toggle="tooltip" title="System.Type">Type</span><span class="punctuation">&gt;</span> <span data-toggle="tooltip" title="LinqCheck.Container.ArgumentTypes(System.Type)">ArgumentTypes</span> <span class="punctuation">(</span><span class="typename" data-toggle="tooltip" title="System.Type">Type</span> type<span class="punctuation">)</span>
		<span class="punctuation">{</span>
			<span class="keyword">return</span> <span class="keyword">from</span> i <span class="keyword">in</span> <span data-toggle="tooltip" title="System.Type">type</span><span class="punctuation" data-toggle="tooltip" title="System.Type.GetInterfaces()">.</span><span data-toggle="tooltip" title="System.Type.GetInterfaces()">GetInterfaces</span> <span class="punctuation">(</span><span class="punctuation">)</span>
				   <span class="keyword">where</span> <span data-toggle="tooltip" title="System.Type">i</span><span class="punctuation" data-toggle="tooltip" title="bool">.</span><span data-toggle="tooltip" title="bool">IsGenericType</span> <span class="punctuation" data-toggle="tooltip" title="bool">&amp;&amp;</span> 
						 <span data-toggle="tooltip" title="System.Type">i</span><span class="punctuation" data-toggle="tooltip" title="System.Type.GetGenericTypeDefinition()">.</span><span data-toggle="tooltip" title="System.Type.GetGenericTypeDefinition()">GetGenericTypeDefinition</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation" data-toggle="tooltip" title="bool">==</span> <span data-toggle="tooltip" title="System.Type"><a href="../src/Container.html#LinqCheck.Container._interface">_interface</a></span>
				   <span class="keyword" data-toggle="tooltip" title="System.Collections.Generic.IEnumerable<System.Type>">select</span> <span data-toggle="tooltip" title="System.Type">i</span><span class="punctuation" data-toggle="tooltip" title="System.Type.GetGenericArguments()">.</span><span data-toggle="tooltip" title="System.Type.GetGenericArguments()">GetGenericArguments</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation" data-toggle="tooltip" title="System.Collections.Generic.IEnumerable<System.Type>.First<System.Type>()">.</span><span data-toggle="tooltip" title="System.Collections.Generic.IEnumerable<System.Type>.First<System.Type>()">First</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
		<span class="punctuation">}</span>
</code></pre>
<p>The last helper method finds the type in the <code>_types</code> dictionary that
implements the interface for the specified type parameter, and
constructs an instance of that class. It needs to create generic
classes and classes that provide implementation for arrays in a
different way.</p>
<pre class="csharp"><code class="csharp">		<span class="keyword" id="LinqCheck.Container.ImplementingType(System.Type)" data-toggle="tooltip" title="LinqCheck.Container.ImplementingType(System.Type)">private</span> <span class="typename" data-toggle="tooltip" title="System.Type">Type</span> <span data-toggle="tooltip" title="LinqCheck.Container.ImplementingType(System.Type)">ImplementingType</span> <span class="punctuation">(</span><span class="typename" data-toggle="tooltip" title="System.Type">Type</span> argType<span class="punctuation">)</span>
		<span class="punctuation">{</span>
			<span class="keyword" data-toggle="tooltip" title="System.Type">var</span> <span id="generic">generic</span> <span class="punctuation">=</span> <span data-toggle="tooltip" title="LinqCheck.Container.GenericDef(System.Type)"><a href="../src/Container.html#LinqCheck.Container.GenericDef(System.Type)">GenericDef</a></span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">argType</span><span class="punctuation">)</span><span class="punctuation">;</span>

			<span class="keyword">if</span> <span class="punctuation">(</span><span class="punctuation" data-toggle="tooltip" title="bool">!</span><span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>"><a href="../src/Container.html#LinqCheck.Container._types">_types</a></span><span class="punctuation" data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>.TryGetValue(System.Type, out System.Type)">.</span><span data-toggle="tooltip" title="System.Collections.Generic.Dictionary<System.Type, System.Type>.TryGetValue(System.Type, out System.Type)">TryGetValue</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">generic</span><span class="punctuation">,</span> <span class="keyword">out</span> <span class="typename" data-toggle="tooltip" title="System.Type">Type</span> implementor<span class="punctuation">)</span><span class="punctuation">)</span>
				<span class="keyword">throw</span> <span class="keyword" data-toggle="tooltip" title="System.InvalidOperationException">new</span> <span class="typename">InvalidOperationException</span> <span class="punctuation">(</span><span class="keyword" data-toggle="tooltip" title="string">string</span><span class="punctuation" data-toggle="tooltip" title="string.Format(string, object)">.</span><span data-toggle="tooltip" title="string.Format(string, object)">Format</span> <span class="punctuation">(</span>
					<span class="string" data-toggle="tooltip" title="string">&quot;Could not find a generator for {0}, please register one.&quot;</span><span class="punctuation">,</span>
					<span data-toggle="tooltip" title="System.Type">generic</span><span class="punctuation" data-toggle="tooltip" title="string">.</span><span data-toggle="tooltip" title="string">Name</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>

			<span class="keyword">return</span> <span data-toggle="tooltip" title="System.Type">generic</span> <span class="punctuation" data-toggle="tooltip" title="bool">==</span> <span class="keyword" data-toggle="tooltip" title="System.Type">typeof</span> <span class="punctuation" data-toggle="tooltip" title="System.Type">(</span><span class="typename" data-toggle="tooltip" title="System.Array">Array</span><span class="punctuation" data-toggle="tooltip" title="System.Type">)</span> <span class="punctuation" data-toggle="tooltip" title="System.Type">?</span>
				<span data-toggle="tooltip" title="System.Type">implementor</span><span class="punctuation" data-toggle="tooltip" title="System.Type.MakeGenericType(params System.Type[])">.</span><span data-toggle="tooltip" title="System.Type.MakeGenericType(params System.Type[])">MakeGenericType</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">argType</span><span class="punctuation" data-toggle="tooltip" title="System.Type.GetElementType()">.</span><span data-toggle="tooltip" title="System.Type.GetElementType()">GetElementType</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation" data-toggle="tooltip" title="System.Type">:</span>
				<span data-toggle="tooltip" title="System.Type">implementor</span><span class="punctuation" data-toggle="tooltip" title="bool">.</span><span data-toggle="tooltip" title="bool">IsGenericTypeDefinition</span> <span class="punctuation" data-toggle="tooltip" title="System.Type">?</span>
					<span data-toggle="tooltip" title="System.Type">implementor</span><span class="punctuation" data-toggle="tooltip" title="System.Type.MakeGenericType(params System.Type[])">.</span><span data-toggle="tooltip" title="System.Type.MakeGenericType(params System.Type[])">MakeGenericType</span> <span class="punctuation">(</span><span data-toggle="tooltip" title="System.Type">argType</span><span class="punctuation" data-toggle="tooltip" title="System.Type.GetGenericArguments()">.</span><span data-toggle="tooltip" title="System.Type.GetGenericArguments()">GetGenericArguments</span> <span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation" data-toggle="tooltip" title="System.Type">:</span>
					<span data-toggle="tooltip" title="System.Type">implementor</span><span class="punctuation">;</span>
		<span class="punctuation">}</span>
	<span class="punctuation">}</span>
<span class="punctuation">}</span>
</code></pre>

				</div>
				<ul class="pager">
	<li class="previous"><a href="../src/DefaultArbitrary.html">Previous: Built-In Arbitrary Types</a></li>
	<li class="next"><a href="../src/TestState.html">Next: Test State and Phases</a></li>
</ul>
			</div>
        </div>
    </div>
    
    <footer class="panel-footer text-center">
        <div align="center">Copyright © 2018 Tommi Johtela</div>
		<div align="right">
			<small>
				Documentation created with <a href="https://johtela.github.io/LiterateProgramming/">Literate Programming</a>.
			</small>
		</div>
    </footer>


    
    <script src="../bootstrap/js/jquery.min.js"></script>
    <script src="../bootstrap/js/bootstrap.min.js"></script>
    <script src="../sidebar/sidebar.js"></script>
    <script src="../syntax-highlight/syntax.js"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
        extensions: ["jsMath2jax.js"]
        });
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML'></script>
	<script src="../mermaid/mermaid.min.js"></script>
	<script>mermaid.initialize({startOnLoad:true});</script>
</body>
</html>